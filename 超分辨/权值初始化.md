# ç¥žç»ç½‘ç»œä¸­çš„æƒå€¼åˆå§‹åŒ–

# ä¸ºä»€ä¹ˆè¦æƒå€¼åˆå§‹åŒ–ï¼Ÿ

æƒé‡åˆå§‹åŒ–çš„**ç›®çš„æ˜¯**ï¼šé˜²æ­¢åœ¨æ·±åº¦ç¥žç»ç½‘ç»œçš„æ­£å‘ï¼ˆå‰å‘ï¼‰ä¼ æ’­è¿‡ç¨‹ä¸­å±‚æ¿€æ´»å‡½æ•°çš„è¾“å‡ºæŸå¤±**æ¢¯åº¦çˆ†ç‚¸**æˆ–**æ¶ˆå¤±**ã€‚å¦‚æžœå‘ç”Ÿä»»ä½•ä¸€ç§æƒ…å†µï¼ŒæŸå¤±æ¢¯åº¦å¤ªå¤§æˆ–å¤ªå°ï¼Œå°±**æ— æ³•æœ‰æ•ˆåœ°åå‘ä¼ æ’­**ï¼Œå¹¶ä¸”å³ä¾¿å¯ä»¥åå‘ä¼ æ’­ï¼Œç½‘ç»œä¹Ÿéœ€è¦èŠ±**æ›´é•¿æ—¶é—´**æ¥è¾¾åˆ°æ”¶æ•›ã€‚

ç½‘ç»œåˆå§‹åŒ–çš„ä¸€èˆ¬åšæ³•ï¼šè®©è¾“å…¥å€¼è½å…¥ç±»ä¼¼ä¸€ä¸ª**å‡å€¼ä¸º0ï¼Œæ ‡å‡†å·®ä¸º1**çš„**æ­£æ€åˆ†å¸ƒ**ä¸­ï¼Œç¡®ä¿è¢«**å½’ä¸€åŒ–**ï¼Œ

å³`torch.randn`å‡½æ•°çš„åšæ³•

å› ä¸ºCNNçš„åšæ³•ç±»ä¼¼äºŽ**ç´¯ç§¯çŸ©é˜µä¹˜æ³•**ï¼Œæ‰€ä»¥æ­£æ€åˆ†å¸ƒçš„åˆå§‹åŒ–ä¸å½“ä¼šé€ æˆä»¥ä¸‹é—®é¢˜ï¼š

- åˆå§‹åŒ–å¤ªå¤§ä¼šé€ æˆæ¢¯åº¦çˆ†ç‚¸
- åˆå§‹åŒ–å¤ªå°ä¼šé€ æˆæ¢¯åº¦æ¶ˆå¤±

# Xavieråˆå§‹åŒ–

> åŸºäºŽæ¿€æ´»å‡½æ•°ä¸ºåŸºäºŽç»™å®šç‚¹å¯¹ç§°çš„ï¼Œå¦‚`tanh`ã€`softsign`è¿™æ ·çš„æ¿€æ´»å‡½æ•°ï¼Œæå‡ºäº†`Xavieråˆå§‹åŒ–`

ä»¥å¾€æ ‡å‡†æƒé‡åˆå§‹åŒ–æ˜¯æ ¹æ®`[-1,1]`ä¸­çš„**å‡åŒ€åˆ†å¸ƒ**æ¥åˆå§‹åŒ–æƒé‡ï¼Œç„¶åŽæŒ‰`1 /âˆšn`çš„æ¯”ä¾‹ç¼©æ”¾ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•å®žé™…ä¸Šå¹¶ä¸èƒ½å¾ˆå¥½åœ°å‘æŒ¥ä½œç”¨ï¼Œå¦‚ä¸‹ï¼š

```python
x = torch.randn(512)
for i in range(100):
    a = torch.Tensor(512, 512).uniform_(-1, 1) * math.sqrt(1. / 512)
    x = tanh(a @ x)
print(x.mean())  # tensor(3.7062e-26)
print(x.std())	 # tensor(9.9671e-25)
```

ä½¿ç”¨è¯¥æƒé‡åˆå§‹åŒ–æ–¹æ³•è¿è¡Œ100å±‚`tanh`ç½‘ç»œ**[æœä»Žä¸Šè¿°åˆ†å¸ƒ]**ä¼šå¯¼è‡´æ¿€æ´»æ¢¯åº¦å˜å¾—æ— é™å°å°±åƒæ¶ˆå¤±äº†ä¸€æ ·ã€‚

æ‰€ä»¥æå‡ºäº†**Xavieråˆå§‹åŒ–**ï¼šå°†æ¯å±‚æƒé‡è®¾ç½®ä¸ºåœ¨æœ‰ç•Œçš„éšæœºå‡åŒ€åˆ†å¸ƒä¸­é€‰æ‹©çš„å€¼

$$
\pm\frac{\sqrt{6}}{\sqrt{n_i+n_{i+1}}}
$$
å…¶ä¸­
$$
n_iæ˜¯è¯¥å±‚çš„ä¼ å…¥ç½‘ç»œè¿žæŽ¥æ•°æˆ–è¯¥å±‚çš„fan-in\\
n_{i+1}æ˜¯è¯¥å±‚çš„ä¼ å‡ºç½‘ç»œè¿žæŽ¥æ•°æˆ–è¯¥å±‚çš„fan-out
$$
`Xavieræƒé‡åˆå§‹åŒ–`å°†ä¿æŒæ¿€æ´»å‡½æ•°å’Œåå‘ä¼ æ’­æ¢¯åº¦çš„**æ–¹å·®**ï¼Œä¸€ç›´å‘ä¸Šæˆ–å‘ä¸‹ä¼ æ’­åˆ°ç¥žç»ç½‘ç»œçš„æ¯ä¸€å±‚

```python
def xavier(m, h):
    return torch.Tensor(m, h).uniform_(-1, 1) * math.sqrt(6. / (m + h))
```

# `Kaiming`åˆå§‹åŒ–

> åŸºäºŽéžå¯¹ç§°çš„æ¿€æ´»å‡½æ•°ï¼Œå¦‚`relu`ç­‰æå‡ºçš„`Kaiming`åˆå§‹åŒ–

1. ä½¿ç”¨é€‚åˆç»™å®šå›¾å±‚çš„æƒé‡çŸ©é˜µåˆ›å»ºå¼ é‡ï¼Œå¹¶ä½¿ç”¨ä»Ž**æ ‡å‡†æ­£æ€åˆ†å¸ƒ**ä¸­éšæœºé€‰æ‹©çš„æ•°å­—å¡«å……å®ƒã€‚

2. å°†æ¯ä¸ªéšæœºé€‰æ‹©çš„æ•°å­—ä¹˜ä»¥`âˆš2/âˆšn`ï¼Œå…¶ä¸­`n`æ˜¯ä»Žå‰ä¸€å±‚è¾“å‡ºåˆ°æŒ‡å®šå±‚çš„è¿žæŽ¥æ•°ï¼ˆä¹Ÿç§°ä¸º`fan-in`ï¼‰

3. **åå·®å¼ é‡**åˆå§‹åŒ–ä¸ºé›¶

```python
def kaiming(m, h):
    return torch.randn(m, h) * math.sqrt(2. / m)
```

åœ¨`relu`ä¸ºæ¿€æ´»å‡½æ•°çš„ç½‘ç»œä¸­ï¼Œå¦‚æžœä½¿ç”¨`Xavier`åˆå§‹åŒ–ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ï¼Œ`Kaimingåˆå§‹åŒ–`åº”è¯¥æ˜¯æˆ‘ä»¬çš„é¦–é€‰æƒé‡åˆå§‹åŒ–ç­–ç•¥ã€‚

![Snipaste_2020-12-01_11-59-51](https://tvax1.sinaimg.cn/large/005tpOh1ly1gl87za2uzdj30n50dtjs9.jpg)

# `pytorch`ä¸­çš„åˆå§‹åŒ–

> `pytorch`ä¸­å·²ç»é›†æˆäº†å¤šç§çš„åˆå§‹åŒ–æ–¹å¼ï¼Œä¸Šè¿°çš„`Xavier`å’Œ`kaiming`åˆå§‹åŒ–éƒ½å¯ä»¥ç›´æŽ¥è°ƒç”¨

1. åˆå§‹åŒ–ä¸º**å‡åŒ€åˆ†å¸ƒ**

- **`torch.nn.init.xavier_uniform(tensor, gain=1)`**
- **`torch.nn.init.kaiming_uniform(tensor, a=0, mode='fan_in')`**

2. åˆå§‹åŒ–ä¸º**é«˜æ–¯åˆ†å¸ƒ(æ­£æ€åˆ†å¸ƒ)**

- **`torch.nn.init.xavier_normal(tensor, gain=1)`**
- **`torch.nn.init.kaiming_normal(tensor, a=0, mode='fan_in')`**

3. æ›´å¤šåˆå§‹åŒ–æ–¹æ³•ðŸ‘‰[å®˜æ–¹æ–‡æ¡£](https://pytorch.org/docs/stable/nn.init.html)

# `pytorch`æ­å»ºç½‘ç»œè‡ªåŠ¨åˆå§‹åŒ–

> é€šè¿‡é˜…è¯»ä¸€äº›ä»£ç æˆ‘ä»¬ä¼šå‘çŽ°ï¼Œæœ‰äº›ç½‘ç»œåªæ­å»ºäº†æ¡†æž¶è€Œæ²¡æœ‰è¿›è¡Œä¸Šè¿°çš„å„ç§åˆå§‹åŒ–ï¼Œé‚£ç½‘ç»œçš„åˆå§‹å‚æ•°æ€Žä¹ˆæ ·å‘¢ï¼Ÿ

é€šè¿‡`TORCH.NN.MODULES.CONV`[æ–‡æ¡£](https://pytorch.org/docs/stable/_modules/torch/nn/modules/conv.html#Conv2d)å¯ä»¥çœ‹å‡ºï¼Œåœ¨`pytorch`æ¡†æž¶ä¼šè‡ªåŠ¨ä½¿ç”¨**`kaiming`å‡åŒ€åˆ†å¸ƒåˆå§‹åŒ–**ç½‘ç»œå‚æ•°

```python
def reset_parameters(self) -> None:
    init.kaiming_uniform_(self.weight, a=math.sqrt(5))
    if self.bias is not None:
        fan_in, _ = init._calculate_fan_in_and_fan_out(self.weight)
        bound = 1 / math.sqrt(fan_in)
        init.uniform_(self.bias, -bound, bound)
```

