#  `Pytorch`æ¨¡å‹ä¿å­˜æœºåˆ¶

> åœ¨è®­ç»ƒä¸­ï¼Œæ¨¡å‹ä¿å­˜è‡³å…³é‡è¦ï¼Œ`pytorch`ä¸­ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ä¿å­˜æœºåˆ¶ï¼š
>
> > ğŸ…°ä¿å­˜æ•´ä¸ªæ¨¡å‹ï¼Œå³`æ¨¡å‹+å‚æ•°`
> >
> > ğŸ…±åªä¿å­˜è®­ç»ƒå‚æ•°

# ä¿å­˜æ•´ä¸ªæ¨¡å‹

```python
# ä¿å­˜
torch.save(model, './model.pth')
# åŠ è½½
model = torch.load('./model.pth')
```

# åªä¿å­˜å‚æ•°

> è¯¥æ–¹æ³•çš„å¥½å¤„æ˜¯å¯ä»¥ç”¨äºåç»­æ¨¡å‹çš„**CPUæµ‹è¯•**ä»¥åŠ**åŠ è½½ç»§ç»­è®­ç»ƒ**

## 1ï¸âƒ£åªä¿ç•™æ¨¡å‹å‚æ•°

```bash
# ä¿å­˜
torch.save(model.state_dict(), '\model.pth')
# åŠ è½½
model = MyModelClass()  
model.load_state_dict(torch.load('\model.pth'))
```

å› ä¸ºè¯¥æ–¹æ³•åªä¿å­˜äº†æ¨¡å‹å‚æ•°ï¼Œæ‰€ä»¥ï¼Œåœ¨åŠ è½½å‚æ•°ä¹‹å‰ï¼Œè¦ç°æœ‰ä¸€ä¸ªç°æœ‰çš„æ¨¡å‹ï¼Œç›¸å½“äºï¼šå¾—ç°æœ‰`ç“¶å­(æ¨¡å‹ï¼‰`ï¼Œæ‰èƒ½å¾€é‡Œé¢çŒ`æ°´ï¼ˆå‚æ•°ï¼‰`

## 2ï¸âƒ£ä¿å­˜æ¨¡å‹å‚æ•°åŠå…¶ä»–ä¿¡æ¯

```python
def checkpoint(epoch):
    model_out_r_path = join(opt.save_models, 'LapSRN_r_epoch_{}.pt'.format(epoch))
    model_out_g_path = join(opt.save_models, 'LapSRN_g_epoch_{}.pt'.format(epoch))
    state_r = {'model': model_r.state_dict(), 'optimizer': optimizer_r.state_dict(), 'epoch':epoch, 'lr':lr_r}
    state_g = {'model': model_g.state_dict(), 'optimizer': optimizer_g.state_dict(), 'epoch':epoch, 'lr':lr_g}
    torch.save(state_r, model_out_r_path)
    torch.save(state_g, model_out_g_path)
    print("Checkpoint saved to {} and {}".format(model_out_r_path, model_out_g_path))
```

è‹¥è¦ä¿å­˜æ¨¡å‹å…¶ä»–ä¿¡æ¯ï¼Œåˆ™è¦åˆ©ç”¨ä¸€ä¸ª`dict`æ¥å­˜å‚¨è€Œååœ¨è¿›è¡Œä¿å­˜

åœ¨æ¨¡å‹åŠç›¸å…³å‚æ•°åŠ è½½æ—¶ï¼š

```python
model_rt = LapSRN_r().cuda()		# å…ˆåŠ è½½æ¨¡å‹
model_gt = LapSRN_g().cuda()
optimizer_rt = optim.Adagrad(model_rt.parameters(), lr=1e-3, weight_decay=1e-5)# åŠ è½½ä¼˜åŒ–å™¨
optimizer_gt = optim.Adagrad(model_gt.parameters(), lr=1e-3, weight_decay=1e-5)

checkpoint_r = torch.load(model_out_r_path)
model_rt.load_state_dict(checkpoint_r['model'])
model_rt.eval()
optimizer_rt.load_state_dict(checkpoint_r['optimizer'])
epochs_rt = checkpoint_r['epoch']

checkpoint_g = torch.load(model_out_g_path)
model_gt.load_state_dict(checkpoint_g['model'])
model_gt.eval()
optimizer_gt.load_state_dict(checkpoint_g['optimizer'])
epochs_gt = checkpoint_g['epoch']
```

ä¹‹åï¼Œæ¨¡å‹å³å¯ç”¨äº**æµ‹è¯•**ä¸**åŠ è½½è®­ç»ƒ**äº†